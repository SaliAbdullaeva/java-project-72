package hexlet.code.database;

import com.zaxxer.hikari.HikariConfig;      // –ö–ª–∞—Å—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–ª–∞ HikariCP
import com.zaxxer.hikari.HikariDataSource;  // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è DataSource —Å –ø—É–ª–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π HikariCP
import javax.sql.DataSource;                 // –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
/*
–ú–µ—Ç–æ–¥ createDataSource —Å–æ–∑–¥–∞–µ—Ç –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ HikariCP.
–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤—ã–±–∏—Ä–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —É–¥–∞–ª—ë–Ω–Ω–æ–π PostgreSQL
–∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ H2 –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç HikariDataSource, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å DataSource.
*/
public class DatabaseConfig {
    // üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚Äî —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    // üëâ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ, –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (—á–µ—Ä–µ–∑ HikariCP, –Ω–∞–ø—Ä–∏–º–µ—Ä)


    // –°–æ–∑–¥–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    public static DataSource createDataSource() {

        // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –æ–Ω–æ –∑–∞–¥–∞–Ω–æ (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞/CI)
        String jdbcUrl = System.getenv("JDBC_DATABASE_URL");

        // –°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è HikariCP
        HikariConfig config = new HikariConfig();

        // –ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è JDBC_DATABASE_URL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—ë –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
        if (jdbcUrl != null && !jdbcUrl.isBlank()) {
            // –ü—Ä–æ–¥–∞–∫—à–µ–Ω-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, PostgreSQL —á–µ—Ä–µ–∑ render.com)
            config.setJdbcUrl(jdbcUrl);
            // –õ–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –±–µ—Ä—É—Ç—Å—è –ø—Ä—è–º–æ –∏–∑ —Å—Ç—Ä–æ–∫–∏, –æ—Ç–¥–µ–ª—å–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ
            config.setDriverClassName("org.postgresql.Driver"); // // –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –¥—Ä–∞–π–≤–µ—Ä–∞ –¥–ª—è PostgreSQL (–ø—Ä–æ–¥–∞–∫—à–µ–Ω)
        } else {
            // –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞: –≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –±–∞–∑–∞ H2 –≤ –ø–∞–º—è—Ç–∏
            config.setJdbcUrl("jdbc:h2:mem:project;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=false");
            config.setDriverClassName("org.h2.Driver"); // –£–∫–∞–∑—ã–≤–∞–µ–º –¥—Ä–∞–π–≤–µ—Ä H2
            config.setUsername("sa");                   // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ª–æ–≥–∏–Ω H2
            config.setPassword("");                     // –ü—É—Å—Ç–æ–π –ø–∞—Ä–æ–ª—å
        }

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –ø—É–ª–∞
        config.setMaximumPoolSize(10); // ‚Äî —ç—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

        System.out.println(">>> –ü–æ–¥–∫–ª—é—á–∞—é—Å—å –∫ –ë–î —á–µ—Ä–µ–∑: " + config.getJdbcUrl());

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≥–æ—Ç–æ–≤—ã–π –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
        return new HikariDataSource(config);

    }
}
